{% extends 'generic/object_edit.html' %}
{% load form_helpers %}
{% load static %}

{% block javascript %}
    {{ block.super }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const interfaceConfigField = document.getElementById('id_interfaceconfig');
            const ipAddressField = document.getElementById('id_ip_address');
            const vlanField = document.getElementById('id_vlan');
            const ipAddressRow = ipAddressField ? ipAddressField.closest('.mb-3') : null;
            const vlanRow = vlanField ? vlanField.closest('.mb-3') : null;

            if (!interfaceConfigField) {
                return;
            }

            function toggleFields() {
                const selectedValue = interfaceConfigField.value;
                
                // IP Address field - only visible for 'static'
                if (ipAddressField && ipAddressRow) {
                    if (selectedValue === 'static') {
                        ipAddressRow.style.display = '';
                    } else {
                        ipAddressRow.style.display = 'none';
                        ipAddressField.value = '';
                    }
                }
                
                // VLAN field - visible for 'static' and 'dhcp'
                if (vlanField && vlanRow) {
                    if (selectedValue === 'static' || selectedValue === 'dhcp') {
                        vlanRow.style.display = '';
                    } else {
                        vlanRow.style.display = 'none';
                        vlanField.value = '';
                    }
                }
            }

            // Initial state
            toggleFields();

            // Listen for changes
            interfaceConfigField.addEventListener('change', toggleFields);
        });
    </script>
{% endblock %}

{% block title %}
    {% if object.pk %}
        Éditer {{ object.name }}
    {% else %}
        Ajouter une Prise Réseau
    {% endif %}
{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li class="breadcrumb-item">
        <a href="{% url 'plugins:plugsbox:plug_list' %}">Prises Réseau</a>
    </li>
    {% if object.pk %}
        <li class="breadcrumb-item">
            <a href="{% url 'plugins:plugsbox:plug' pk=object.pk %}">{{ object.name }}</a>
        </li>
    {% endif %}
{% endblock %}

{% block form %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <h5 class="card-header">Informations Générales</h5>
            <div class="card-body">
                {% render_field form.name %}
                {% render_field form.site %}
                {% render_field form.location %}
                {% render_field form.tenant %}
                {% render_field form.contact %}
                {% render_field form.status %}
            </div>
        </div>
        
        <div class="card mt-3">
            <h5 class="card-header">Configuration Réseau</h5>
            <div class="card-body">
                {% render_field form.interfaceconfig %}
                {% render_field form.vlan %}
                {% render_field form.ip_address %}
            </div>
        </div>
        
        <div class="card mt-3">
            <h5 class="card-header">Commentaires</h5>
            <div class="card-body">
                {% render_field form.activation_date %}
                {% render_field form.comments %}
            </div>
        </div>
    </div>
</div>
{% endblock %}